
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generator Modul Ajar SDN CILUAR 1</title>
  <style>
    :root{{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}}
    body{{margin:0;padding:18px;background:#f3f7fb;color:#0b1a2b}}
    .wrap{{max-width:1100px;margin:12px auto;padding:16px;background:#fff;border-radius:10px;box-shadow:0 8px 30px rgba(13,38,76,.06)}}
    header{{display:flex;align-items:center;gap:12px}}
    header img{{width:64px;height:64px;border-radius:8px}}
    h1{{font-size:20px;margin:0}}
    .desc{{color:#476074;font-size:13px}}
    .layout{{display:grid;grid-template-columns:1fr 460px;gap:16px;margin-top:12px}}
    @media(max-width:980px){{.layout{{grid-template-columns:1fr}}}}
    .card{{padding:12px;border-radius:8px;border:1px solid #e6eef6;background:#fbfeff}}
    label{{display:block;font-size:13px;color:#173246;margin-bottom:6px}}
    input[type=text],textarea,select{{width:100%;padding:8px;border-radius:6px;border:1px solid #d7e8fb;font-size:14px;background:#fff}}
    textarea{{min-height:90px;resize:vertical}}
    .row{{display:flex;gap:8px}}
    .actions{{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}}
    button{{padding:8px 12px;border-radius:8px;border:0;background:#0b74de;color:#fff;cursor:pointer}}
    .ghost{{background:transparent;border:1px solid #cfe4ff;color:#0b74de}}
    .small{{font-size:13px;color:#5b7285}}
    .preview{{min-height:320px;overflow:auto}}
    .controls{{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}}
    .footer{{margin-top:12px;font-size:13px;color:#516074}}
    .note{{font-size:12px;color:#7b8896}}
    .inline{{display:inline-block}}
    .tag{{background:#eaf4ff;padding:4px 8px;border-radius:999px;font-size:12px;color:#0b74de}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="assets/logo.png" alt="Logo Sekolah">
      <div>
        <h1>Generator Modul Ajar â€” SDN CILUAR 1</h1>
        <div class="desc">Jl. Batara KP.Tarikolot Rt 1/4 kel. Ciluar kec. Bogor utara kota bogor</div>
      </div>
      <div style="margin-left:auto" class="inline">
        <span class="tag">SDN CILUAR 1</span>
      </div>
    </header>

    <div class="layout">
      <div class="card">
        <label>Nama Sekolah</label>
        <input id="sekolah" type="text" value="SDN CILUAR 1">

        <label style="margin-top:8px">Alamat Sekolah (opsional)</label>
        <input id="alamat" type="text" value="Jl. Batara KP.Tarikolot Rt 1/4 kel. Ciluar kec. Bogor utara kota bogor">

        <div class="row" style="margin-top:8px">
          <div style="flex:1">
            <label>Fase / Kelas</label>
            <select id="kelas">
              <option value="faseA">Fase A - Kelas 1-2</option>
              <option value="faseB">Fase B - Kelas 3-4</option>
              <option value="faseC">Fase C - Kelas 5-6</option>
            </select>
          </div>
          <div style="width:170px">
            <label>Jumlah JP</label>
            <input id="jp" type="text" placeholder="4 JP @35mnt">
          </div>
        </div>

        <label style="margin-top:8px">Mata Pelajaran</label>
        <input id="mapel" type="text" placeholder="Semua">

        <label style="margin-top:8px">Tema / Topik</label>
        <input id="tema" type="text" placeholder="Masukkan tema atau topik">

        <label style="margin-top:8px">Penulis / Guru</label>
        <input id="guru" type="text" placeholder="Nama Guru">

        <label style="margin-top:8px">Model Pembelajaran</label>
        <select id="model" class="short">
          <option>Project Based Learning</option>
          <option>Discovery Learning</option>
          <option>Problem Based Learning</option>
          <option>Kooperatif</option>
          <option>Langsung / Ceramah + Praktik</option>
        </select>

        <label style="margin-top:8px">Capaian Pembelajaran (CP)</label>
        <textarea id="cp" placeholder="Isi CP manual, atau klik 'Cari Referensi' untuk ambil otomatis"></textarea>

        <div class="controls">
          <button id="fetchRefs" type="button">ðŸ”Ž Cari Referensi Otomatis (online)</button>
          <button id="insertLib" class="ghost" type="button">ðŸ“š Isi CP dari Perpustakaan (offline)</button>
          <button id="generate" type="button">Generate Modul</button>
          <button id="saveDraft" class="ghost" type="button">ðŸ’¾ Simpan Draft (browser)</button>
          <button id="loadDraft" class="ghost" type="button">ðŸ“‚ Muat Draft</button>
          <button id="clear" class="ghost" type="button">Clear</button>
        </div>

        <label style="margin-top:10px">Tujuan Pembelajaran (pisah baris)</label>
        <textarea id="tujuan" placeholder="1. Siswa dapat ..."></textarea>

        <label style="margin-top:8px">Sarana & Sumber</label>
        <textarea id="sumber" placeholder="Buku siswa, video, lingkungan, dll"></textarea>

        <label style="margin-top:8px">Asesmen (pisah koma)</label>
        <input id="asesmen" placeholder="Diagnostik, Formatif, Sumatif, Proyek">

        <label style="margin-top:8px">Profil Pelajar Pancasila</label>
        <input id="profil" placeholder="Mandiri, Kreatif, Gotong Royong">

        <label style="margin-top:8px">Refleksi Guru</label>
        <textarea id="ref" placeholder="Catatan guru setelah pelaksanaan"></textarea>

        <div class="note" style="margin-top:8px">Catatan: tombol 'Cari Referensi' akan mencoba mengambil data dari sumber resmi bila tersedia (koneksi & CORS diperlukan). Jika gagal, gunakan 'Isi CP dari Perpustakaan'.</div>
      </div>

      <div class="card preview" id="previewCard">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <strong>Preview Modul</strong>
          <div class="small">Status: <span id="status">siap</span></div>
        </div>

        <div id="modContent" style="margin-top:10px"></div>

        <div class="actions" style="margin-top:12px">
          <button id="downloadDocx">Download .docx</button>
          <button id="downloadPdf" class="ghost">Download PDF</button>
          <button id="printBtn" class="ghost">Print</button>
          <button id="copyHtml" class="ghost">Copy HTML</button>
        </div>

        <div class="footer">
          <div><strong>Perpustakaan CP (contoh):</strong> gunakan tombol <em>Isi CP dari Perpustakaan</em> untuk memasukkan CP dasar per fase.</div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <strong>Cara deploy cepat (GitHub Pages)</strong>
      <ol style="margin-top:6px">
        <li>Buat repositori baru di GitHub dengan nama <code>generator-modul-ajar-sdn-ciluar-1</code> & upload file di repo ini.</li>
        <li>Settings â†’ Pages â†’ pilih branch main â†’ / (root) â†’ Save. Setelah deploy muncul link <code>https://USERNAME.github.io/generator-modul-ajar-sdn-ciluar-1/</code>.</li>
      </ol>
    </div>
  </div>

<script>
const CP_LIBRARY = {{
  faseA: "CP Fase A (Kelas 1-2):\n- Mengenal huruf, kata, dan kalimat sederhana.\n- Menyajikan kegiatan sederhana lisan.\n- Menggunakan konsep bilangan dasar.",
  faseB: "CP Fase B (Kelas 3-4):\n- Memahami teks naratif sederhana.\n- Melakukan operasi hitung bolak-balik.\n- Menyajikan hasil kerja kelompok.",
  faseC: "CP Fase C (Kelas 5-6):\n- Menganalisis isi teks dan menyusun ringkasan.\n- Menyelesaikan masalah matematika tingkat lanjut.\n- Melakukan proyek ilmiah sederhana."
}};

function esc(html){ return (html||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function buildModuleHTML(data){
  const tujuanList = (data.tujuan||'').split('\n').filter(x=>x.trim()).map(x=>`<li>${{esc(x)}}</li>`).join('');
  return `
    <div>
      <h2 style="margin:0 0 6px">${{esc(data.tema||'Modul Ajar')}}</h2>
      <div style="color:#455">${{esc(data.sekolah||'')}} â€” ${{esc(data.kelas||'')}}</div>
      <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;margin-top:10px">
        <tr><td style="width:160px"><strong>Mata Pelajaran</strong></td><td>${{esc(data.mapel||'')}}</td></tr>
        <tr><td><strong>Alokasi Waktu</strong></td><td>${{esc(data.jp||'')}}</td></tr>
        <tr><td><strong>Penulis</strong></td><td>${{esc(data.guru||'')}}</td></tr>
        <tr><td><strong>Model</strong></td><td>${{esc(data.model||'')}}</td></tr>
      </table>

      <h3>Capaian Pembelajaran (CP)</h3>
      <pre style="white-space:pre-wrap;background:#f4fbff;padding:8px;border-radius:6px">${{esc(data.cp||'')}}</pre>

      <h3>Tujuan Pembelajaran</h3>
      <ol>${{tujuanList}}</ol>

      <h3>Sarana & Sumber</h3><p>${{esc(data.sumber||'')}}</p>
      <h3>Asesmen</h3><p>${{esc(data.asesmen||'')}}</p>
      <h3>Profil Pelajar Pancasila</h3><p>${{esc(data.profil||'')}}</p>
      <h3>Refleksi Guru</h3><p>${{esc(data.ref||'')}}</p>
    </div>
  `;
}

function readForm(){{
  return {{
    sekolah: document.getElementById('sekolah').value,
    alamat: document.getElementById('alamat').value,
    kelas: document.getElementById('kelas').value,
    mapel: document.getElementById('mapel').value,
    tema: document.getElementById('tema').value,
    jp: document.getElementById('jp').value,
    guru: document.getElementById('guru').value,
    model: document.getElementById('model').value,
    cp: document.getElementById('cp').value,
    tujuan: document.getElementById('tujuan').value,
    sumber: document.getElementById('sumber').value,
    asesmen: document.getElementById('asesmen').value,
    profil: document.getElementById('profil').value,
    ref: document.getElementById('ref').value
  }};
}

function updatePreview(){{
  const data = readForm();
  document.getElementById('modContent').innerHTML = buildModuleHTML(data);
  document.getElementById('status').innerText = 'preview updated';
}}

const DRAFT_KEY = 'modulAjarDraft_v1';
document.getElementById('saveDraft').addEventListener('click', ()=>{{
  const data = readForm();
  localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
  alert('Draft disimpan di browser (localStorage).');
}});
document.getElementById('loadDraft').addEventListener('click', ()=>{{
  const raw = localStorage.getItem(DRAFT_KEY);
  if(!raw){{ alert('Tidak ada draft tersimpan.'); return; }}
  const d = JSON.parse(raw);
  for(const k in d) if(document.getElementById(k)) document.getElementById(k).value = d[k];
  updatePreview();
  alert('Draft dimuat.');
}});

document.getElementById('insertLib').addEventListener('click', ()=>{{
  const fase = document.getElementById('kelas').value || 'faseA';
  document.getElementById('cp').value = CP_LIBRARY[fase] || '';
  updatePreview();
}});

document.getElementById('generate').addEventListener('click', ()=>{{
  updatePreview();
  document.getElementById('status').innerText = 'generated';
}});

document.getElementById('copyHtml').addEventListener('click', async ()=>{{
  try{{ await navigator.clipboard.writeText(document.getElementById('modContent').innerHTML); alert('HTML modul tersalin ke clipboard.'); }}
  catch(e){{ alert('Tidak bisa menyalin otomatis: '+e.message); }}
}});

document.getElementById('printBtn').addEventListener('click', ()=>{{
  const w = window.open('', '_blank');
  w.document.write('<!doctype html><html><head><meta charset="utf-8"><title>Print Modul</title></head><body>');
  w.document.write(document.getElementById('modContent').innerHTML);
  w.document.write('</body></html>');
  w.document.close();
  w.print();
}});

document.getElementById('fetchRefs').addEventListener('click', async ()=>{{
  const fase = document.getElementById('kelas').value || 'faseA';
  document.getElementById('status').innerText = 'mencari referensi...';
  try{{
    const attempts = [
      `https://merdekabelajar.kemdikbud.go.id/api/cp?fase=${{fase}}`,
      `https://raw.githubusercontent.com/merdeka-sample/cp/master/${{fase}}.json`
    ];
    let success = false;
    for(const url of attempts){{
      try{{
        const res = await fetch(url);
        if(!res.ok) throw new Error('not ok');
        const txt = await res.text();
        let content = '';
        try{{ const j = JSON.parse(txt); content = j.cp || JSON.stringify(j, null, 2); }}
        catch(_ ){{ content = txt; }}
        document.getElementById('cp').value = content;
        updatePreview();
        document.getElementById('status').innerText = 'referensi berhasil diambil';
        success = true; break;
      }}catch(e){{ console.warn('fetch failed', url, e); }}
    }}
    if(!success){{ document.getElementById('status').innerText = 'gagal (gunakan perpustakaan CP)'; alert('Gagal mengambil referensi otomatis. Gunakan tombol "Isi CP dari Perpustakaan" atau muat CP manual.'); }}
  }}catch(err){{ console.error(err); document.getElementById('status').innerText = 'error'; alert('Terjadi error saat mencari referensi: ' + err.message); }}
}});

['sekolah','alamat','kelas','mapel','tema','jp','guru','model','cp','tujuan','sumber','asesmen','profil','ref'].forEach(id=>{{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', ()=>{{ clearTimeout(window._deb); window._deb = setTimeout(updatePreview, 350); }});
}});

updatePreview();
</script>
</body>
</html>
